# 问卷数据清洗

适用范围：本规范适用于所有基于结构化问卷的清洗任务。
核心目标：将模糊、异构的原始问卷数据，转化为逻辑一致、格式统一、可分析的标准化数据集。  
关键原则：理解先于处理，规范先于代码。

## 为什么问卷清洗特别依赖前期理解？

与其他数据源（如 API、日志、数据库）不同，问卷数据的生成过程高度依赖人为设计与执行，但这一过程往往缺乏完整记录。常见问题包括：

- 跳转逻辑未被标注（如“Q5仅当Q3=‘是’时出现”）；
- 选项编码混乱（同一问题在不同批次使用不同数值）；
- “未回答”与“不适用”混为一类缺失；
- 多选题存储格式不统一（逗号分隔？多列？）。

若跳过对采集过程的回溯，清洗极易陷入“反复返工”或“误删有效信息”的陷阱。

✅ 因此，清洗的第一步不是写代码，而是重建数据的“出生证明”。

## 核心交付物：数据模型

Codebook 是问卷清洗的唯一权威依据，本质是数据模型的书面定义。它必须在编码前由客户确认，并作为后续所有工作的基准。

Codebook 应包含以下要素：
要素   说明   示例
变量名   标准化后的字段名称   q3_satisfaction

原始来源   对应原始文件中的列名或位置   Column_7 或 Question 3

变量类型   数值 / 分类 / 文本 / 日期 / 虚拟变量   分类

值标签   所有合法取值及其含义   1=非常不满意, 2=不满意, ..., 5=非常满意

缺失规则   何种情况视为缺失？如何编码？   -99 = 未回答, -88 = 不适用

逻辑约束   与其他问题的关联规则   “仅当 q1_job=1（在职）时有效”

📌 注意：Codebook 不是技术文档，而是业务与技术团队的共识协议。建议使用表格形式，避免纯文本描述。

## 标准化清洗流程

### 阶段 1：需求对齐与数据探查
- 动作：与客户确认清洗目标、输出格式、关键业务规则。
- 产出：签署版 Codebook + 数据问题清单。
- 示例问题：  
  > “量表题 Q10–Q15 中，Q12 为反向计分题，需在清洗时统一方向。”

### 阶段 2：元数据标准化

- 目标：统一基础数据格式，消除技术噪声。
- 关键操作：
  - 时间字段 → 统一为 YYYY-MM-DD HH:MM:SS
  - 文本编码 → 统一为 UTF-8
  - 数值字段 → 剥离单位、符号（如“¥100” → 100）

### 阶段 3：结构化清洗

（1）分类变量处理
- 将文本选项映射为预定义数值编码  
  示例：  
  原始值：“男”/“女” → 编码：1/2

（2）多选题拆分
- 将单列多选（如“苹果,香蕉”）拆分为多个虚拟变量  
  示例：  
  fruit_apple = 1, fruit_banana = 1, fruit_orange = 0

（3）逻辑一致性校验
- 检查跳转逻辑是否被违反  
  示例：  
  若 Q3=“否”，但 Q4（仅当 Q3=“是”时出现）有值 → 标记为异常

（4）缺失值精细化处理
- 区分：
  - 系统缺失（未展示该题）→ 编码为 -88
  - 用户跳过（展示了但未答）→ 编码为 -99
- 禁止直接删除或均值填充，除非客户明确要求。

阶段 4：质量验证
- 完整性检查：字段数、样本量是否符合预期？
- 分布合理性：满意度均值是否在 1–5 范围内？
- 逻辑验证：年龄 < 18 的样本是否被正确过滤？

阶段 5：交付
- 清洗后数据（CSV/Excel）
- 可复现清洗代码（含详细注释）
- 最终版 Codebook
- 异常处理日志（记录所有人工干预点）

## 角色分工建议

角色   责任
项目经理   主导需求沟通，协调客户确认 Codebook，定义交付范围

数据架构师   提供问卷逻辑说明、跳转规则、业务背景

数据工程师   基于 Codebook 编写清洗代码，执行质量验证

质量保证   抽样核对清洗结果与 Codebook 一致性

⚠️ 重要：数据工程师不应独自承担“理解问卷逻辑”的责任——这是跨角色协作的关键节点。

## 附录：常见陷阱提醒

- ❌ 假设“空值 = 未回答”（可能实际是“不适用”）  
- ❌ 忽略反向计分题，导致量表方向错误  
- ❌ 用“0”填充缺失，扭曲统计结果  
- ❌ 未保留中间步骤，无法追溯修改原因  
