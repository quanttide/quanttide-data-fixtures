# 问卷数据清洗

## 数据模型

> **说明**：本部分定义清洗后数据集的**逻辑结构与语义规则**，是清洗工作的唯一权威依据。实际项目中，此表需由业务方与数据团队共同确认并签署。

| 字段名 | 原始来源 | 类型 | 值标签/格式规范 | 缺失编码 | 逻辑约束 |
|--------|--------|------|----------------|--------|--------|
| `submit_time` | 提交时间列 | datetime | `YYYY-MM-DD HH:MM:SS` | — | 必填 |
| `age` | 年龄题 | integer | 范围：18–70 | `-99` | ≥18 |
| `tenure_years` | 工作年限 | float | 范围：0–50 | `-99` | ≥0 |
| `department` | 所属部门 | categorical | `1=生产, 2=研发, 3=销售, 4=职能, 5=其他` | `-99` | — |
| `satisfaction` | 满意度量表 | integer | `1=非常不满意 → 5=非常满意` | `-99` | 正向计分 |
| `workload` | 工作负荷量表 | integer | `1=非常轻松 → 5=非常繁重` | `-99` | 反向计分（清洗时转为：`6 - 原值`） |
| `benefits_raw` | 福利多选题（原始） | string (raw) | 原始值如："五险一金,带薪年假" | `-99` | — |
| `benefit_insurance` | 虚拟变量：五险一金 | binary | `1=选择, 0=未选择` | — | 由 `benefits_raw` 拆分生成 |
| `benefit_vacation` | 虚拟变量：带薪年假 | binary | `1=选择, 0=未选择` | — | 同上 |
| `benefit_medical` | 虚拟变量：补充医疗 | binary | `1=选择, 0=未选择` | — | 同上 |
| `other_dept_specify` | "其他部门"说明文本 | text | 提取 `〖〗` 内内容，如 `〖外包团队〗` → `外包团队` | `-99` | 仅当 `department = 5` 时有效 |


> 📌 **关键原则**：
> 1. 所有分类变量必须数值化编码；
> 2. 多选题必须拆分为虚拟变量（0/1）；
> 3. 量表题方向必须统一（反向题需转换）；
> 4. 缺失值必须区分"未回答"（`-99`）与"不适用"（`-88`）。

## 数据处理流程

### 阶段 1：元数据标准化
| 操作 | 规则 | 示例 |
|------|------|------|
| 时间格式统一 | 所有时间转为 `datetime` 标准格式 | `2025/12/01 14:30` → `2025-12-01 14:30:00` |
| 文本编码清理 | 统一为 UTF-8，去除不可见字符 | — |
| 数值字段净化 | 剥离单位、符号，转为纯数字 | `"35岁"` → `35` |

### 阶段 2：结构化清洗
#### （1）分类变量编码
- 将文本选项映射为预定义整数  
  **输入**：`"研发"` → **输出**：`2`

#### （2）多选题处理
- 拆分逗号分隔字符串，生成虚拟变量  
  **输入**：`"五险一金,带薪年假"`  
  **输出**：  
  `benefit_insurance = 1`  
  `benefit_vacation = 1`  
  `benefit_stock = 0`（若该选项存在）

#### （3）量表题方向统一
- 识别反向计分题（如"工作负荷"），执行转换：  
  **公式**：`正向得分 = 最大值 + 1 - 原始值`  
  **示例**：原值 `4`（繁重）→ 转换为 `2`（低满意度）

#### （4）开放题"其他"选项提取
- 使用正则提取 `〖...〗` 中的内容  
  **输入**：`其他〖希望增加远程办公〗`  
  **输出**：`q9_other_text = "希望增加远程办公"`

#### （5）缺失值精细化处理
- 根据问卷跳转逻辑标记缺失类型：  
  - 若问题因跳转未展示 → 编码为 `-88`（不适用）  
  - 若问题已展示但未答 → 编码为 `-99`（未回答）

### 阶段 3：逻辑一致性校验
- **规则示例**：  
  - `入职年份` ≤ 当前年份  
  - `出生年份` < `入职年份`  
  - 若 `q3_dept ≠ 5`（非"其他"），则 `q9_other_text` 应为空或 `-99`

### 阶段 4：异常值检测
- **数值型字段**（年龄、工作年限）：  
  - 超出 `[18, 70]` 或 `[0, 50]` 范围 → 标记为异常，保留原始值并记录日志


## 数据集

> **说明**：本部分由项目经理与技术负责人填写，描述最终交付成果。此处仅为模板占位。

| 交付项 | 格式 | 说明 |
|--------|------|------|
| 清洗后数据集 | CSV | 包含所有标准化字段，无原始脏数据 |
| 数据字典 | PDF/Markdown | 即本文件"数据模型"部分 |
| 清洗代码 | `.py` / `.ipynb` | 含完整注释，可复现全流程 |
| 异常处理日志 | TXT | 记录所有人工干预点及原因 |


## 附录：常见挑战与处理思路

| 挑战 | 处理思路 |
|------|--------|
| 多选题格式不统一 | 拆分为虚拟变量，每个选项独立编码为 0/1 |
| 跳转逻辑导致缺失 | 基于问卷逻辑区分"合理缺失"与"异常缺失" |
| 量表正反向混合 | 识别反向题，统一转换为正向计分 |
| "其他"选项文本杂乱 | 提取 `〖〗` 括号内内容作为标准化文本 |
| 时间格式多样 | 统一转换为 `YYYY-MM-DD HH:MM:SS` |
| 数值异常值 | 设置合理范围（如年龄 18–70），标记而非删除 |
| 逻辑矛盾 | 设计业务规则检查（如入职年份 > 出生年份） |
| 分类变量文本化 | 创建统一数值编码体系 |
| 缺失值模式系统性 | 分析缺失分布，识别采集阶段问题 |

